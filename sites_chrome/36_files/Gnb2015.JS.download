var _RealTimeOver = false;

function go_url(url) {
    var anchor = document.createElement("a");
    if (!anchor.click) {
        window.location = url;
        return;
    }
    anchor.setAttribute("href", url);
    anchor.style.display = "none";
    document.body.appendChild(anchor);
    anchor.click();
}


$(function() {
    //$('body').on({
    // "mouseover": function(event) {
    
    $("body").mouseover(function(event) {

        // 메뉴 오버시 미니 보이기
        if ($(event.target).closest('.gnb').length || $(event.target).closest('.layer_mini').length) {
            var pID = "";
            if ($(event.target).closest('.gnb').length) pID = "dv" + $(event.target).closest('.gnb').attr('id') + "Mini";
            if ($(event.target).closest('.layer_mini').length) pID = $(event.target).closest('.layer_mini').attr('id');

            $('.layer_mini').hide();
            $('#' + pID).show();

            $('.gnb').find('a').removeClass('on');
            if ($(event.target).closest('.layer_mini').length) {
                pID = $(event.target).closest('.layer_mini').attr('id').replace('dv', '');
                pID = pID.replace('Mini', '');
                $('#' + pID).find('a').addClass('on');
            }
        }
        else {
            $('.layer_mini').hide();
            SetMenu();
        }

        // 오버시 탑보드 공유버튼
        if ($(event.target).closest('.rollover').length) {
            $('.droppable').find(".twitter").hide();
            $('.droppable').find(".facebook").hide();
            $('.droppable').find(".kastory").hide();

            $(event.target).closest('.droppable').find(".twitter").show();
            $(event.target).closest('.droppable').find(".facebook").show();
            $(event.target).closest('.droppable').find(".kastory").show();
        }
        else {
            $('.droppable').find(".twitter").hide();
            $('.droppable').find(".facebook").hide();
            $('.droppable').find(".kastory").hide();
        }


    });

    // 실시간 뉴스
    setInterval(RealTimeNews, 3000);
    // $('body').on({
    //     "mouseover": function(event) {
    $("body").mouseover(function() {
        if ($(event.target).closest('.text').length) {
            _RealTimeOver = true;
        }
        else
            _RealTimeOver = false;

    });

    // 메뉴 세팅
    SetMenu();

    //검색세팅
    $("#btnSearch").click(function() {
        location.href = "/NWS_Web/Search/s_ohmynews.aspx?keyword=" + escape($("#txtSearch").val());
        return false;
    });
    $("#txtSearch").keyup(function(e) {
        if (e.keyCode == "13")
            location.href = "/NWS_Web/Search/s_ohmynews.aspx?keyword=" + escape($("#txtSearch").val());
    });

    // 알림
    if (location.href.indexOf('.htm') > -1 || location.href == "http://www.ohmynews.com/" || location.href == "http://www.ohmynews.com/?isPc=true" || location.href == "http://www.ohmynews.com?isPc=true") {

        // 시간 세팅
        if (location.href.indexOf("index_N0001.htm") > -1) {
            Timer("/OJS_AdminWeb/Pub_DT.aspx");
        } else {
            Timer("/NWS_Web/NWS_ADM/CMPT_ADM/Pub_DT.aspx");
        }

        // 모바일 브라우져체크
        if (navigator.userAgent.indexOf("Mobile") >= 0
            || navigator.userAgent.indexOf("Windows CE") >= 0
            || navigator.userAgent.indexOf("SymbianOS") >= 0
            || navigator.userAgent.indexOf("Series60") >= 0
            || navigator.userAgent.indexOf("Windows Phone") >= 0
            || navigator.userAgent.indexOf("Nexus") >= 0
            || navigator.userAgent.indexOf("iPhone") >= 0
           ) {
            //if (navigator.userAgent.indexOf("iPad") < 0) {
                var isPc = js_search_to_object()["isPc"];
                if (document.referrer.indexOf("http://www.ohmynews.com") == 0) isPc = "true";
                if (document.referrer.indexOf("http://star.ohmynews.com") == 0) isPc = "true";
                if (isPc != "true") {
                    // location.href = "http://m.ohmynews.com";
                    location.replace("http://m.ohmynews.com");
                    //go_url("http://m.ohmynews.com");
                }
                else {
                    $("#wrap").after("<div class='m_view'><a href='http://m.ohmynews.com/'>모바일버전보기</a></div>");
                }
            //}

            // 스마트폰에서 플래시 지원안되 TI 광고제거(보이지는 않으나 영역을 차지하고 있어 아래 기사가 클릭이 안됨)
            $('.main_tis_ad').hide();
        }
    }

    //메인 광고1
    $('.adTop').find('.btn_close').click(function() {
        $('.adTop').hide();
    });

    var pHREF = location.href.toLowerCase();

    if (pHREF.indexOf("/old_main") == -1 && location.href.indexOf("kweather.ohmynews.com") == -1) {
        //시민기자/기사수
        if ($('.civic_group').length) {
            var pStr = $.ajax({
                url: "/NWS_Web/Common/Pages/CommAjaxFunction.aspx",
                async: false,
                type: "POST",
                data: ({ std: 'ReporterCnt' })
            }).responseText;

            if ($('.noticelist').length == 0) {
                $('.civic_group').find(".con").html(pStr);
            }
        }


        //10만인 숫자 셋팅
        $.ajax({
            type: "GET",
            url: "/NWS_Web/Common/Pages/Tencount.aspx",
            success: function(msg) {
                if ($(".tenin01").length > 0) {
                    $(".tenin01").html(msg);
                }
                
                if ($("#emClubCount").length > 0) {
                    $("#emClubCount").html(msg);
                }
                
                if ($("#f_clubnum").length > 0)
                    $("#f_clubnum").html($("#f_clubnum").html().replace("0", msg));

                if ($("#clubcnt").length > 0)
                    $("#clubcnt").html(msg);
            },
            error: function(error) {
            }
        });
    }
});

// 실시간 뉴스
function RealTimeNews() {
    if (!_RealTimeOver) {
        var pNextObj;
        if ($('.noticelist:visible').next().length > 0)
            pNextObj = $('.noticelist:visible').next();
        else
            pNextObj = $('.noticelist:first');

        $('.noticelist:visible').hide();
        pNextObj.show();

        if ($('.noticelist:visible').attr('id') == "pLive") {
            $("#spIcon").attr("class", "onair");
            $("#spIcon").attr("title", "생방송");
        }
        else if ($('.noticelist:visible').attr('id') == "pNotice") {
            $("#spIcon").attr("class", "know");
            $("#spIcon").attr("title", "속보");        
        }
    }
}


// 시간 세팅
function Timer(pURL) {
    if ($("#hdnWeather").length == 0 && $('#time').length > 0 && location.href.indexOf("kweather.ohmynews.com") == -1) {
        $.ajax({
            type: "GET",
            url: pURL,
            success: function(msg) {
                $('#time').html($(msg).find('div:last').html());
            },
            error: function(error) {
            }
        });
    }
}

// 메뉴 세팅
function SetMenu() {
    $('.gnb').find('a').removeClass('on');
    $("#" + $('#ctl00_hdnTopMenu').val()).find('a').addClass("on");
}