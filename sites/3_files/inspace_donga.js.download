
var ILSA_ConfChild = function(){
	this.media = "donga";
	this.mainId = "article_txt";
	this.load_jQuery = false;
	this.bottomMargin = 150;
	this.isRight = true;
	this.exceptArea = [".sub_cont_AD08", ".articlePhotoR", ".articlePhotoC", ".article_relation"];
	this.adHtml = "<div style='line-height:13px; margin:0px 7px 0px 0px;'><div id='adPremium' style='float:left;width:34px;height:13px;margin-right:6px'><a href='http://ad.kakaocorp.com/adinfo/search' onclick='ilsaMain.IsaIconClick=true' target='_blank'><img src='//img2.keywordsconnect.com/inspace_premium.gif' style='border:none;vertical-align:top;' ></a></div><div style='margin:3px 0 0 10px;float:left'><a href='[#LINK#]' target='_blank' alt='[#DESC#]' title='[#DESC#]' target='_blank' style='color:#225178;font-size:12px;font-weight:normal;line-height:15px;cursor:pointer;text-decoration:none;' onclick='closeIsad([#IDX#])'>[#TITLE#]</a></div><div id='closeBox' style='width:11px;height:11px;left:253px;top:-13px;position:absolute'><img src='//img2.keywordsconnect.com/inspace_close1.gif' style='cursor:pointer;width:11px;height:11px;vertical-align:top;' onclick='ilsaMain.IsaIconClick=true;closeIsad([#IDX#])' /></div></div><br><div id='ILSA_TogArea' style='clear:both;line-height:15px;'><a href='[#LINK#]' target='_blank' id='ILSA_descArea' style='font-size:12px;padding-left:5px;color:#565656;cursor:pointer;font-weight:normal;text-decoration:none;display:none' onclick='closeIsad([#IDX#])'>[#DESC#]</a><br><a href='[#LINK#]' target='_blank' id='ILSA_siteArea' style='font-size:12px;padding-left:5px;color:#218d44;cursor:pointer;text-decoration:none;display:none;font-weight:normal;' onclick='closeIsad([#IDX#])'>[#SITE#]</a></div><a id='ISA_Link' href='[#LINK#]' style='display:none'></a>";
	this.delay = 300;
	this.marginSpace = 60;
	this.zIndex = 100;
	this.lineBottomMargin = 3;
	this.scrollTimer = null;
};

var ILSA_UtilChild = function(){
	this.cT = function(){
		return true;
	};
};

var ILSA_MainChild = function(){

	this.beforeInit = function(){
		var hostname = document.location.hostname;
		if(hostname.indexOf("shindonga.donga.com") > -1){
			ilsaConf.media = "donga_shindonga";
			ilsaConf.mainId = "article_text";
		}else if(hostname.indexOf("weekly.donga.com") > -1){
			ilsaConf.media = "donga_weekly";
			ilsaConf.mainId = "text";
		}else if(hostname.indexOf("magazine.donga.com") > -1){
			ilsaConf.media = "donga_magazine";
			ilsaConf.mainId = "text";
			ilsaConf.marginSpace = 0;
		}else{
			if(!$$$("."+ilsaConf.mainId).attr("id")){
				$$$("."+ilsaConf.mainId).attr("id","articleBody");
			}

			ilsaConf.mainId = $$$("."+ilsaConf.mainId).attr("id");

			ilsaConf.adHtml = "<div style='line-height:13px; margin:0px 7px 0px 0px;'><div id='adPremium' style='float:left;width:34px;height:13px;margin-right:6px'><a href='http://ad.kakaocorp.com/adinfo/search' onclick='ilsaMain.IsaIconClick=true' target='_blank'><img src='//img2.keywordsconnect.com/inspace_premium.gif' style='border:none;vertical-align:top;' ></a></div><div style='margin:" + (navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0?"3":"2") + "px 0 0 10px;float:left'><a href='[#LINK#]' target='_blank' alt='[#DESC#]' title='[#DESC#]' target='_blank' style='color:#225178;font-size:12px;font-weight:normal;line-height:15px;cursor:pointer;text-decoration:none;' onclick='closeIsad([#IDX#])'>[#TITLE#]</a></div><div id='closeBox' style='width:11px;height:11px;left:253px;top:-13px;position:absolute'><img src='//img2.keywordsconnect.com/inspace_close1.gif' style='cursor:pointer;width:11px;height:11px;vertical-align:top;' onclick='ilsaMain.IsaIconClick=true;closeIsad([#IDX#])' /></div></div><br><div id='ILSA_TogArea' style='clear:both;line-height:15px;'><a href='[#LINK#]' target='_blank' id='ILSA_descArea' style='font-size:12px;padding-left:5px;color:#565656;cursor:pointer;font-weight:normal;text-decoration:none;display:none' onclick='closeIsad([#IDX#])'>[#DESC#]</a><br><a href='[#LINK#]' target='_blank' id='ILSA_siteArea' style='font-size:12px;padding-left:5px;color:#218d44;cursor:pointer;text-decoration:none;display:none;font-weight:normal;' onclick='closeIsad([#IDX#])'>[#SITE#]</a></div><a id='ISA_Link' href='[#LINK#]' style='display:none'></a>";
		}
	};

	this.afterInit = function(){
		var tmpPrevTop = -1;
		var tmpCurPos = -1;
		var tmpRemove = [];
		var isPass = false;
		for(var i=1;i<this.inspaceTags.length;i++){
			tmpCurPos = this.inspaceTags.eq(i).offset().top;
			tmpPrevTop = this.inspaceTags.eq(i-1).offset().top;
			if(isPass) {isPass = false;continue;}
			if(tmpPrevTop + 32 > tmpCurPos) {tmpRemove.push(i);isPass = true;}
		}

		for(elem in tmpRemove){
			this.inspaceTags.eq(tmpRemove[elem]).remove();
		}
		this.inspaceTags = $$$("span[name=inspace_pos]");
	};

	this.init_Inspace = function(){

		this.beforeInit();

		this.mainLeft = $$$("#"+ilsaConf.mainId, ilsaUtil.getFrameObj()).position().left;
		this.mainSize = $$$("#"+ilsaConf.mainId, ilsaUtil.getFrameObj()).width();
		this.mainRight = this.mainLeft + this.mainSize;

		var mainObj = ilsaConf.media == "donga_magazine" ? $$$(".article_txt", ilsaUtil.getFrameObj()) : $$$("#"+ilsaConf.mainId, ilsaUtil.getFrameObj());

		mainObj.find("p").append("<span name='inspace_pos'>&nbsp;</span>");
		mainObj.find("br").before("<span name='inspace_pos'>&nbsp;</span>");

		this.inspaceTags = $$$("span[name=inspace_pos]", ilsaUtil.getFrameObj());
		var mainLeft = $$$("#"+ilsaConf.mainId, ilsaUtil.getFrameObj()).position().left;
		var tmpRemove = [];

		for(var i = 0; i < this.inspaceTags.size(); i++){
			if($$$(this.inspaceTags[i]).position().left <= mainLeft + ilsaConf.marginSpace) {tmpRemove.push(i);continue;}
			if($$$(this.inspaceTags[i]).position().left + ilsaConf.adSize.width - (mainLeft == 0 ? ilsaConf.marginSpace : 0) >= this.mainRight) {tmpRemove.push(i);continue;}
		}

		for(var i = 0; i < tmpRemove.length; i++){
			this.inspaceTags.eq(tmpRemove[i]).remove();
		}

		this.inspaceTags = $$$("span[name=inspace_pos]", ilsaUtil.getFrameObj());

		try {
			for(var i = 0; i < ilsaConf.exceptArea.length; i++){
				var exceptObj = $$$(ilsaConf.exceptArea[i], ilsaUtil.getFrameObj());
				if(exceptObj.size() == 0) continue;
				if(exceptObj.size() > 1) {
					for(var j = 0; j < exceptObj.size(); j++){
						for(var k = 0; k < this.inspaceTags.size(); k++){
							this.checkRemoveTags($$$(this.inspaceTags[k]), $$$(exceptObj[j]));
						}
					}
				} else {
					for(var k = 0; k < this.inspaceTags.size(); k++){
						this.checkRemoveTags($$$(this.inspaceTags[k]), exceptObj);
					}
				}
			}
		} catch (e) {
			//console.log("exception");
		}

		this.inspaceTags = $$$("span[name=inspace_pos]", ilsaUtil.getFrameObj());

		this.afterInit();

		ilsaUtil.attachEvt(ilsaConf.isIframe ? parent.window : window, 'resizeend', function(){ ilsaMain.resizeCheck(); });
		ilsaUtil.attachEvt(ilsaConf.isIframe ? parent.window : window, 'resize',  function(){ ilsaMain.resizeCheck(); ilsaMain.mousePosCheck(); });
		// ilsaUtil.attachEvt(ilsaConf.isIframe ? parent.window : window, 'scroll',  function(){ ilsaMain.mousePosCheck(); });
		// ilsaUtil.attachEvt(ilsaConf.isIframe ? parent.window : window, 'mousewheel',  function(){ ilsaMain.mousePosCheck(); });

		$$$(ilsaConf.isIframe ? parent.window : window).bind("scroll mousewheel", function(){
			clearTimeout(ilsaConf.scrollTimer);
			ilsaConf.scrollTimer = setTimeout(function(){
				ilsaMain.mousePosCheck();
			},20);
		});

		this.createAdArea();
		this.getAd();

	};

	this.checkRemoveTags = function(tagObj, exceptObj){

		if(ilsaConf.isRight || (tagObj.offset().left + ilsaConf.adSize.width >= exceptObj.offset().left)) {
			if(tagObj.offset().top + this.lineHeight >= exceptObj.offset().top && tagObj.offset().top <= exceptObj.offset().top + exceptObj.height()){
				var mainOffsetLeft = $$$("#"+ilsaConf.mainId, ilsaUtil.getFrameObj()).offset().left;
				if(ilsaConf.isInner && tagObj.offset().left + ilsaConf.adSize.width + exceptObj.width() + 2 < mainOffsetLeft + this.mainSize && !(exceptObj.offset().left < mainOffsetLeft + (this.mainSize/2) && exceptObj.offset().left + exceptObj.width > mainOffsetLeft+ (this.mainSize/2) ) ){
					var isLeft = this.mainLeft + (this.mainSize/2) < exceptObj.offset().left;
					var mainRight = this.mainLeft + this.mainSize;
					var exceptObjMargin = mainOffsetLeft + this.mainSize - exceptObj.offset().left - exceptObj.width();
					var pos = ilsaConf.isRight ? mainRight - (isLeft ? exceptObj.width() + exceptObjMargin : 0) - ilsaConf.adSize.width - ilsaConf.marginSpace + $$$("#"+ilsaConf.mainId, ilsaUtil.getFrameObj()).offset().left - this.mainLeft : tagObj.offset().left;
					tagObj.attr("class","inspace_pos" + pos);
				}else{
					tagObj.remove();
				}
			}
		}
	};
};

var ilsaMain = null;
var ilsaUtil = null;
var ilsaPageInfo = null;
var ilsaConf = null;

ilsaAdLaunch = function(){

	ILSA_ConfChild.prototype = new ILSA_Config();
	ILSA_MainChild.prototype = new ILSA_Main();
	ILSA_UtilChild.prototype = new ILSA_Util();

	ilsaUtil = new ILSA_Util();

	ilsaMain = new ILSA_MainChild();
	ilsaConf = new ILSA_ConfChild();
	ilsaUtil = new ILSA_UtilChild();

	var pathname = document.location.pathname;
	if(pathname.indexOf("/ISSUE/Vote2016/") > -1){
		ilsaConf.media = "donga_vote";
		ilsaConf.adHtml = "<div style='line-height:13px; margin:0px 7px 0px 0px;'><div id='adPremium' style='float:left;width:34px;height:13px;margin-right:6px'><a href='http://ad.kakaocorp.com/adinfo/search' onclick='ilsaMain.IsaIconClick=true' target='_blank'><img src='//img2.keywordsconnect.com/inspace_premium.gif' style='border:none' ></a></div><div style='margin:2px 0 0 10px;float:left'><a href='[#LINK#]' target='_blank' alt='[#DESC#]' title='[#DESC#]' target='_blank' style='color:#225178;font-size:12px;font-weight:normal;line-height:15px;cursor:pointer;text-decoration:none;' onclick='closeIsad([#IDX#])'>[#TITLE#]</a></div><div id='closeBox' style='width:11px;height:11px;left:253px;top:-13px;position:absolute'><img src='//img2.keywordsconnect.com/inspace_close1.gif' style='cursor:pointer;width:11px;height:11px;vertical-align:top;' onclick='ilsaMain.IsaIconClick=true;closeIsad([#IDX#])' /></div></div><br><div id='ILSA_TogArea' style='clear:both;line-height:16px;'><a href='[#LINK#]' target='_blank' id='ILSA_descArea' style='font-size:12px;padding-left:5px;color:#565656;cursor:pointer;font-weight:normal;text-decoration:none;display:none' onclick='closeIsad([#IDX#])'>[#DESC#]</a><br><a href='[#LINK#]' target='_blank' id='ILSA_siteArea' style='font-size:12px;padding-left:5px;color:#218d44;cursor:pointer;text-decoration:none;display:none;font-weight:normal;' onclick='closeIsad([#IDX#])'>[#SITE#]</a></div><a id='ISA_Link' href='[#LINK#]' style='display:none'></a>";
	}else if(pathname.indexOf("/ISSUE/2016Rio/") > -1){
		ilsaConf.media = "donga_rio";
	}else if(pathname.indexOf("/ISSUE/election2016/") > -1){
		ilsaConf.media = "donga_election";
	}else if(pathname.indexOf("/ISSUE/2017president/") > -1){
		ilsaConf.media = "donga_president";
	}else if(pathname.indexOf("/ISSUE/2018Pyeongchang/") > -1){
		ilsaConf.media = "donga_pyeongchang";
	}else if(pathname.indexOf("/ISSUE/Vote2018/") > -1){
		ilsaConf.media = "donga_vote";
	}

	ilsaMain.init();

};


var inspaceAdScript = document.createElement("script");
inspaceAdScript.id = "iconAdSetScript";
inspaceAdScript.src = "//js2.keywordsconnect.com/Inspace_new_v2.0.js";
inspaceAdScript.type = "text/javascript";
var inspaceAdHeader = document.getElementsByTagName("head")[0];
inspaceAdHeader.appendChild(inspaceAdScript);