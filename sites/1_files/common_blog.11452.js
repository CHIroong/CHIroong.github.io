$(function(){var E=$("body");var J=E.attr("data-blog-id");var m=$("#app-menu-toggler");var O=$("#app-menu");var c=$("#app-menu-backdrop");m.on("click",function(){O.toggle();c.toggle()});c.on("click",function(){O.hide();c.hide()});var t=$("body[data-post-id]");var A=$("#post-content");if(t.length>0||A.length>0){var s=t.attr("data-post-id");$.ajax({url:cdnUrl+"/assets/plugin/require/require.min.js",dataType:"script",success:function(){requirejs.config({baseUrl:postypeUrl+"/assets/plugin/",packages:[{name:"codemirror",location:"./codemirror",main:"lib/codemirror"}]});requirejs(["codemirror"],function(Q){Q.defaults.lineWrapping=true;Q.defaults.lineNumbers=true;var R=$("figure.code");if(R.length>0){requirejs(["codemirror/addon/runmode/runmode"],function(){R.each(function(T,V){var S=$(V);var X=S.find("textarea");var W=S.find("pre");var U=W.attr("data-type");if(U!="text"){requirejs(["codemirror/mode/"+U+"/"+U],function(){Q.fromTextArea(X.get(0),{lineNumbers:true,lineWrapping:true,mode:U,readOnly:true})})}else{Q.fromTextArea(X.get(0),{lineNumbers:true,lineWrapping:true,mode:U,readOnly:true})}})})}})}});var M=false;var P="read."+J+"."+s;var H=window.location.hostname;var L=E.attr("data-read-stats");if(L==="1"){$(window).scroll(function(){if($(window).scrollTop()>$(document).height()*0.7){var Q=Cookies.get(P);if(!Q){Cookies.set(P,true,{expires:1,path:"/",domain:H});if(M===false){M=true;$.ajax({url:postypeUrl+"/postype/read",type:"get",dataType:"jsonp",data:"blog_id="+J+"&post_id="+s,success:function(R){if(R.status==="success"){}}})}}}})}var u=$("#btn-like-user");var a=$("#like-user");var F=$("#like-user-list");var h=$("#btn-more-like-user");var o=1;u.on("click",function(){F.empty();a.modal("show");$.ajax({url:postypeUrl+"/postype/getLikeUsers",type:"get",dataType:"jsonp",data:"post_id="+s+"&page="+o,success:function(Q){if(Q.status==="success"){$(Q.data.items).each(function(R,S){F.append(S)});if(Q.data.page<Q.data.total_pages){h.show();h.attr("data-page",parseInt(Q.data.page)+1)}else{h.hide()}}}})});h.on("click",function(){o=h.attr("data-page");h.attr("disabled","disabled");h.text("로딩중");$.ajax({url:postypeUrl+"/postype/getLikeUsers",type:"get",dataType:"jsonp",data:"post_id="+s+"&page="+o,success:function(Q){if(Q.status==="success"){$(Q.data.items).each(function(R,S){F.append(S)});if(Q.data.page<Q.data.total_pages){h.show();h.attr("data-page",parseInt(Q.data.page)+1)}else{h.hide()}h.removeAttr("disabled");h.text("더 보기")}}})});var k=$("#other-posts-wrapper");if(k.length>0){var z=$("#other-posts-page");var d=z.val();$.ajax({url:postypeUrl+"/postype/getRelatedPosts",type:"get",dataType:"jsonp",data:"post_id="+s+"&page="+d,success:function(Q){if(Q.status==="success"){k.html(Q.data);$("#other-posts-loading").hide()}}});k.on("click","a.page-link-prev, a.page-link-next",function(){var Q=$(this).attr("data-page");z.val(Q);$("#other-posts-pagination").hide();$("#other-posts-loading").show();$.ajax({url:postypeUrl+"/postype/getRelatedPosts",type:"get",dataType:"jsonp",data:"post_id="+s+"&page="+Q,success:function(R){if(R.status==="success"){k.html(R.data);$("#other-posts-pagination").show();$("#other-posts-loading").hide()}}});return false})}var p=$("#comment-list");var x=1;var I=$("#btn-more-comment");if(p.length>0){var N=0;if(location.hash){N=location.hash.replace("#comment-","")}$.ajax({url:postypeUrl+"/postype/getComments",type:"get",dataType:"jsonp",data:"post_id="+s+"&page="+x+"&comment_id="+N,success:function(Q){if(Q.status==="success"){$(Q.data.items).each(function(R,S){p.prepend(S)});if(Q.data.page<Q.data.total_pages){I.show();I.attr("data-page",parseInt(Q.data.page)+1)}else{I.hide()}if(location.hash){setTimeout(function(){var R=$(location.hash).offset().top-$("#header").height();$(window).scrollTop(R)},100)}}}})}I.on("click",function(){j()});function j(){I.attr("disabled","disabled");I.text("로딩중");x=I.attr("data-page");$.ajax({url:postypeUrl+"/postype/getComments",type:"get",dataType:"jsonp",data:"post_id="+s+"&page="+x,success:function(Q){if(Q.status==="success"){$(Q.data.items).each(function(R,S){p.prepend(S)});if(Q.data.page<Q.data.total_pages){I.show();I.attr("data-page",parseInt(Q.data.page)+1)}else{I.hide()}I.removeAttr("disabled");I.text("이전 댓글 보기")}}})}resetAudio();resizePhotoset();resizeIframe();$(window).resize(function(){resetAudio();resizePhotoset();resizeIframe()});A.addClass("visible");A.find("a").each(function(Q,S){var R=$(S);if(!R.hasClass("btn")){R.attr("target","_blank")}});var B=$("#secret-form");if(B.length>0){B.on("submit",function(){var Q=B.find("input[name=password]").val();$.ajax({url:postypeUrl+"/post/secret",type:"get",dataType:"jsonp",data:"post_id="+s+"&password="+encodeURIComponent(Q),success:function(R){if(R.status=="success"){location.reload()}else{alertPostype(R.message)}}});return false})}$(".btn-post-delete").on("click",function(){var Q=$(this).attr("href");confirmPostype("해당 포스트를 삭제하시겠습니까?",function(){$.ajax({url:Q,type:"get",dataType:"jsonp",success:function(R){if(R.status=="success"){location.href=$("body").attr("data-blog-url")}else{alertPostype(R.message)}}})});return false});var y=$("#comment-form");var i=$("#comment-reply-form");var q=$("#comment-edit-form");if(y.length>0){y.off("submit");y.submit(function(){var Q=y.find("button.btn-submit");Q.loading(true);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(S){if(S.status==="success"){var R=S.data.key;y.find("input[name=session_key]").val(R);y.ajaxSubmit({type:"POST",dataType:"json",iframe:true,target:"#hidden-iframe",success:function(T){if(T.status==="success"){p.append(T.data.html);y.find("textarea").val("");y.find("input[type=checkbox]").prop("checked",false)}else{if(T.status==="no-permission"){confirmPostype(T.message,function(){location.href=postypeUrl+"/login"})}else{alertPostype(T.message)}}},error:function(V,T,U){alertPostype("code:"+V.status+"\nmessage:"+V.responseText+"\nerror:"+U)},complete:function(){Q.loading(false)}})}}});return false});i.off("submit");i.submit(function(){var Q=i.find("button.btn-primary");Q.loading(true);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(S){if(S.status==="success"){var R=S.data.key;i.find("input[name=session_key]").val(R);i.ajaxSubmit({type:"POST",dataType:"json",iframe:true,target:"#hidden-iframe",success:function(U){if(U.status==="success"){i.modal("hide");var V=$("#comment-"+U.data.comment.sort1);if(V.length>0){while(true){var T=V.next();if(T.length===0){V.after(U.data.html);break}else{if(!T.hasClass("reply")){V.after(U.data.html);break}}V=T}}}else{if(U.status==="no-permission"){confirmPostype(U.message,function(){location.href=postypeUrl+"/login"})}else{alertPostype(U.message)}}},error:function(V,T,U){alertPostype("code:"+V.status+"\nmessage:"+V.responseText+"\nerror:"+U)},complete:function(){Q.loading(false)}})}}});return false});q.off("submit");q.submit(function(){var Q=q.find("button.btn-primary");Q.loading(true);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(S){if(S.status==="success"){var R=S.data.key;q.find("input[name=session_key]").val(R);q.ajaxSubmit({type:"POST",dataType:"json",iframe:true,target:"#hidden-iframe",success:function(T){if(T.status==="success"){q.modal("hide");var U=$("#comment-"+T.data.comment.comment_id);U.after(T.data.html);U.remove()}else{if(T.status==="no-permission"){confirmPostype(T.message,function(){location.href=postypeUrl+"/login"})}else{alertPostype(T.message)}}},error:function(V,T,U){alertPostype("code:"+V.status+"\nmessage:"+V.responseText+"\nerror:"+U)},complete:function(){Q.loading(false)}})}}});return false});$(document).on("click",".btn-comment-open-reply",function(){var R=$(this);var Q=R.parents(".item");var S=R.attr("data-comment-id");R.attr("disabled","disabled");$.ajax({url:postypeUrl+"/postype/getChildren",type:"get",dataType:"jsonp",data:"parent_id="+S+"&post_id="+s,success:function(U){if(U.status==="success"){var T="";$(U.data.items).each(function(V,W){T+=W});Q.after(T)}R.hide()}})});$(document).on("click",".btn-comment-reply",function(){var V=$(this);var R=V.parents(".item");var U=R.attr("data-sort1");var Q=R.find(".comment-header");var W=R.find(".comment-content");var S=W.find("p");var X=$.trim(S.text());i.find(".comment-header .author").text(Q.find(".author").text());i.find(".comment-header img").attr("src",R.find("img.user-avatar").attr("src"));i.find(".parent-comment").html(nl2br(X));i.find("[name=parent_id]").val(U);if(R.hasClass("is-secret")){i.find("[name=is_secret]").attr("checked","checked")}else{i.find("[name=is_secret]").removeAttr("checked")}var T=$("#reply-form-image");if(R.hasClass("use-image")){T.show();i.find(".image-before").show();i.find("input[name=file_id]").val("");i.find("input[type=file]").val("");i.find(".image-after").hide();i.find(".image-uploading").hide()}else{T.hide()}i.find("textarea").val("");i.modal("show")});$(document).on("click",".btn-comment-edit",function(){var W=$(this);var X=W.parents(".item");var S=X.attr("data-comment-id");var V=X.find(".comment-content");var T=V.find("p");var Y=$.trim(T.text());q.attr("action","/comment/"+S);q.find("textarea").val(Y.replace(/(<br>|<br\/>|<br \/>)/g,"\r\n"));if(X.hasClass("is-secret")){q.find("[name=is_secret]").attr("checked","checked")}else{q.find("[name=is_secret]").removeAttr("checked")}var R=$("#comment-edit-form-image");if(X.hasClass("use-image")){R.show();var U=X.find(".comment-image");if(U.length>0){var Q=q.find(".image-after");Q.show();Q.find("img").attr("src",U.attr("src"));q.find("input[name=file_id]").val(U.attr("data-file-id"));q.find(".image-before").hide();q.find("input[type=file]").val("");q.find(".image-uploading").hide()}else{q.find(".image-before").show();q.find("input[name=file_id]").val("");q.find("input[type=file]").val("");q.find(".image-after").hide();q.find(".image-uploading").hide()}}else{R.hide()}q.modal("show")})}var D=$("#modal-support");$(".btn-support").on("click",function(){var R=$(this);var Q=parseInt(R.attr("data-post-user-id"));if(Q===0){alertPostype("블로그 팀 멤버에서 탈퇴한 작가의 포스트는 후원할 수 없습니다.")}else{if(D.length>0){D.modal("show")}else{confirmPostype("로그인이 필요한 서비스입니다. 로그인 페이지로 이동하시겠습니까?",function(){location.href=postypeUrl+"/login"})}}});var w=$("#modal-purchase");$(".btn-purchase").on("click",function(){var R=$(this);var Q=parseInt(R.attr("data-post-user-id"));if(Q===0){alertPostype("블로그 팀 멤버에서 탈퇴한 작가의 포스트는 구매할 수 없습니다.")}else{if(w.length>0){w.modal("show")}else{confirmPostype("로그인이 필요한 서비스입니다. 로그인 페이지로 이동하시겠습니까?",function(){location.href=postypeUrl+"/login"})}}});D.on("submit",function(){e(D);return false});w.on("submit",function(){e(w);return false});function e(Q){var R=Q.find("button.btn-primary");R.loading(true);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(T){if(T.status==="success"){var S=T.data.key;Q.find("input[name=session_key]").val(S);Q.modal("hide");Q.ajaxSubmit({url:"/post/support",type:"post",dataType:"json",success:function(U){if(U.status==="success"){alertPostype(U.message,function(){window.history.go(0)})}else{if(U.status==="no-permission"){confirmPostype(U.message,function(){location.href=postypeUrl+"/login"})}else{alertPostype(U.message,function(){Q.modal("show")})}}},error:function(W,U,V){alertPostype("code:"+W.status+"\nmessage:"+W.responseText+"\nerror:"+V)},complete:function(){R.loading(false)}})}}})}var l=$("#support-lack-point");var r=$("#support-own-point");var g=$("#support-remain-point");if(parseInt(r.attr("data-value"))<100){l.show()}else{l.hide()}D.on("change keyup","input[name=point]",function(){var Q=$(this).val();if(Q==""){Q=0}var R=parseInt(r.attr("data-value"))-parseInt(Q);g.text(R.format());if(R>=0){l.hide()}else{l.show()}});$(".btn-reset-uploaded-image").on("click",function(){var Q=$(this).parents("form");Q.find(".image-before").show();Q.find("input[name=file_id]").val("");Q.find(".image-after").hide();Q.find(".image-before").show()});$(".support-image").on("change",function(){var X=$(this);var Z=X.parents("form");var T=X.get(0);var Y=10*1024*1024;var U=0;var W=navigator.appName;if(W=="Microsoft Internet Explorer"){var V=new ActiveXObject("Scripting.FileSystemObject");U=V.getFile(T.value).size}else{U=T.files[0].size}if(U>Y){alertPostype("사진은 10MB 이내로 등록 가능합니다.");return}var R=Z.find(".image-before");var Q=Z.find(".image-uploading");var S=Z.find(".image-after");R.hide();Q.show();Z.ajaxSubmit({url:"/postype/upload",dataType:"json",type:"post",iframe:true,target:"#hidden-iframe",success:function(aa){if(aa.status==="success"){Z.find("input[name=file_id]").val(aa.data.file_id);S.find("img").attr("src",aa.data.thumbnail);Q.hide();S.show()}else{if(aa.status==="failure"){alertPostype(aa.message);R.show();Q.hide()}}},complete:function(){if($("html").hasClass("ie")){X.replaceWith(X.clone())}else{X.val("")}}});return false});var v=$("#post-number-form");if(v.length>0){v.off("submit");v.on("submit",function(){$.ajax({url:postypeUrl+"/post/getPostByNumber",type:"get",dataType:"jsonp",data:"post_id="+v.find("input[name=post_id]").val()+"&episode_number="+v.find("input[name=episode_number]").val(),success:function(Q){if(Q.status==="success"){location.href=Q.data}else{alertPostype(Q.message)}}});return false})}var K=$("#background-white");var C=$("#background-black");var f=$("article.post:first");K.on("click",function(){K.addClass("active");C.removeClass("active");Cookies.set("bgcolor","white",{expires:1,path:"/",domain:H});$("#header").removeClass("post-bg-black");f.removeClass("post-bg-black");$.ajax({url:postypeUrl+"/user/setBackgroundColor",type:"get",dataType:"jsonp",data:"bgcolor=white",success:function(Q){if(Q.status==="success"){}}})});C.on("click",function(){K.removeClass("active");C.addClass("active");Cookies.set("bgcolor","black",{expires:1,path:"/",domain:H});$("#header").addClass("post-bg-black");f.addClass("post-bg-black");$.ajax({url:postypeUrl+"/user/setBackgroundColor",type:"get",dataType:"jsonp",data:"bgcolor=black",success:function(Q){if(Q.status==="success"){}}})});var G=Cookies.get("bgcolor");if(G==="black"){$("#header").addClass("post-bg-black");f.addClass("post-bg-black");K.removeClass("active");C.addClass("active")}else{if(G==="white"){$("#header").removeClass("post-bg-black");f.removeClass("post-bg-black");K.addClass("active");C.removeClass("active")}else{$.ajax({url:postypeUrl+"/user/getBackgroundColor",type:"get",dataType:"jsonp",success:function(Q){if(Q.status==="success"){if(Q.data==="black"){$("#header").addClass("post-bg-black");f.addClass("post-bg-black");K.removeClass("active");C.addClass("active")}else{if(Q.data==="white"){$("#header").removeClass("post-bg-black");f.removeClass("post-bg-black");K.addClass("active");C.removeClass("active")}}if(Q.data){Cookies.set("bgcolor",Q.data,{expires:365,path:"/",domain:H})}}}})}}}function n(){try{return window.self!==window.top}catch(Q){return true}}if(n()){window.addEventListener("message",function(T){if(~T.origin.indexOf("http://www.postype.org")||~T.origin.indexOf("http://www.postype.net")||~T.origin.indexOf("https://www.postype.com")){$("#app-menu-container").hide();if(T.data.request){if(T.data.request==="text"){$(T.data.target).text(T.data.text)}else{if(T.data.request==="textarea"){$(T.data.target).text(T.data.text)}else{if(T.data.request==="style"){var V=$("#custom-style");if(V.length>0){V.remove()}var S="<style id='custom-style'>"+T.data.style+"</style>";$("head").append(S)}else{if(T.data.request==="toggle"){var U=T.data.className.split(",");var Q=T.data.target.split(",");var R=T.data.type;$(Q).each(function(X,Z){var W=$(Z);var Y=U[X];if(R==="add"){if(Y!==""){W.addClass(Y)}}else{if(R==="remove"){if(Y!==""){W.removeClass(Y)}}}})}}}}}}else{return false}});b({request:"getStyle"});function b(Q){parent.postMessage(Q,"*")}$("a").on("click",function(){var Q=$(this).attr("href");if(Q.indexOf("www.postype.")!==-1){alertPostype("테마 편집 화면에서는 동작하지 않습니다.");return false}})}});;