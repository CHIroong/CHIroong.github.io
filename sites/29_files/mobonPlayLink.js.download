var isView = false;
var playReady = false;
	
	var adInfoObj = (function(){
		return {
			getAbPosition: function(obj) {
				var position = new Object;
				position.y = 0;
				if(obj) {
					position.y = obj.offsetTop;
					if(obj.offsetParent) {
						var parentpos = adInfoObj.getAbPosition(obj.offsetParent);
						position.y += parentpos.y;
					}
				}
				position.cy = obj.offsetHeight;
				return position;
			}
			
			, getScrollTop: function() {
				var scrOfY = 0;
				if (typeof(window.pageYOffset) == 'number') {
					scrOfY = window.pageYOffset;
				}else if (document.documentElement && document.documentElement.scrollTop) {
					scrOfY = document.documentElement.scrollTop;
				}else if (document.body && document.body.scrollTop) {
					scrOfY = document.body.scrollTop;
				}
				return scrOfY;
			}
			, getClientHeigth: function() {
				return document.compatMode=='CSS1Compat'? document.documentElement.clientHeight : document.body.clientHeight;
			}
			, getScrollHeight: function() {
				var scrollHeight = document.compatMode == 'CSS1Compat' ? document.documentElement.scrollHeight : document.body.scrollHeight;
				return scrollHeight;
			}
			, footerDisplay: function(iframeHeight) {
				var innerHeight = 0;
				if( typeof( window.innerWidth ) == 'number' ) {
					//Non-IE
					innerHeight = window.innerHeight;
				} else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
					//IE 6+ in 'standards compliant mode'
					innerHeight = document.documentElement.clientHeight;
				} else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
					//IE 4 compatible
					innerHeight = document.body.clientHeight;
				}
				var iframeName = 'elpPlayer03';
				var widthPang=document.getElementById( iframeName );
				widthPang.height=0;
				widthPang.width= '100%';
				
				//iframeHeight값 조율
				if(innerHeight > 900){
					iframeHeight = parseInt(innerHeight) + 200;
				}else if(innerHeight > 800){
					iframeHeight = parseInt(innerHeight) + 250;
				}else{
					iframeHeight = parseInt(innerHeight) + 300;
				}
			
				var fnSetHeightOfWidthPang = function(height) {
					setTimeout(function(){
						widthPang.height = height;
						scrollTo(0, adInfoObj.getScrollHeight());
					}, 1);
				}

				var fnSetAniHeightOfWidthPang = function (height) {
					$("#"+ iframeName).animate({height:height}, 
						{duration: 1000,
						 step		 : function(){	scrollTo(0, adInfoObj.getScrollHeight());	}, 
						 complete: function(){	scrollTo(0,  adInfoObj.getScrollHeight());	}		});
					
					var offset = $("#"+ iframeName).offset();
					$('html, body').animate({scrollTop : offset.top}, 1000);
					
				}
				try {
					fnSetAniHeightOfWidthPang(iframeHeight);
				}catch(e) {
					fnSetHeightOfWidthPang(iframeHeight);
				}
			}
			//위캔도 플레이어 ready 이벤트가 되어야 플레이어 시작 할 수 있음(로딩 시간차 문제로 플레이가 안될 소지가 있어 체크함)
			, playReadyCheck : function(oIframe){
				var setPlayReadyCheck = setInterval(function() {
					if(playReady){
						//console.log("mobonPlayLink >> playReady");
						oIframe.style.display = "block";
						oIframe.contentWindow.postMessage("playLinkStart", location.protocol + "//www.dreamsearch.or.kr");
						clearInterval(setPlayReadyCheck);
					}
				}, 200);
			}

		};
	})();
	
	var fnOnScroll = function() {
		//console.log("fnOnScroll!!");
		
		var scrollTop = adInfoObj.getScrollTop();
		var clientHeight = adInfoObj.getClientHeigth();
		var scrollHeight = adInfoObj.getScrollHeight();
		var scrollPos= parseInt(scrollHeight) - parseInt(scrollTop);
		
		st = window.pageYOffset;
		var oRootDiv = mobonRootBodyDiv;
		var oIframe = oRootDiv.firstElementChild;
		
		if(st >= adInfoObj.getAbPosition(oRootDiv).y - window.innerHeight + oRootDiv.offsetHeight/2) {
			if(!isView){
				//oIframe.style.display = 'block';
				isView = true;
				//console.log("isView!!!!!!!!!!");
				adInfoObj.playReadyCheck(oIframe);
			}
		}
		
		//푸터 수정해야함
		var footerVideo = document.getElementById("elpVideo_03");
		if(footerVideo != null){
			if( clientHeight >= scrollPos-roundFoot ) {
				if(!isView){
					adInfoObj.footerDisplay("503");
					isView = true;
				}
			}
		}
	};
	
	
	(function(){
		//매체에 넣은 변수정보 맵핑
		var oRootDiv = mobonRootBodyDiv;
		var oRootDivId = oRootDiv.id;
		var videoWidth = mobonPlBodyW;
		var videoHeight = mobonPlBodyH;
		var iframeId = "elpPlayer";
		
		oRootDiv.innerHTML = "<iframe name='"+iframeId+"' id='"+iframeId+"' style='position: relative; margin:0 auto; display:none;' src='" + "//www.dreamsearch.or.kr/servlet/adPlayLinkServlet?elpAdView=true&s="+mobonPlBodyS+"' marginheight='0' marginwidth='0' scrolling='no' width='"+videoWidth+"px' height='"+videoHeight+"px' frameborder='0' ></iframe>";
		addEvent(window, 'scroll', fnOnScroll);
		addEvent(window, 'resize', fnOnScroll);
	})();
	
	function receiveMessage(event) {
		//로딩 관련 내용
		/*
		if(event.data == "loadingRemove" || event.data == "aniLoadingRemove"){
			//console.log("receiveMessage!!!!!!!");
			if(document.getElementById('loading') != null){
	        	console.log("loading >>  삭제");
	        	document.getElementById('loading').style.display = 'none';
	        	//playReady = true;
	        	//애니메이션
	        	//if(adInfoObj.animation == "true")	event.source.postMessage("aniStart", event.origin);
			}
		}*/
		
		if(event.data == "playReady"){
			playReady = true;
		}
		
		if(event.data == "playerDisplay"){
			//console.log("playerDisplay!!");
			mobonRootBodyDiv.firstElementChild.style.display = 'block';
		}
	}

	function fAddEventListener(){
		if ('addEventListener' in window) {
			//console.log("addEventListener");
			window.addEventListener('message', receiveMessage, false); 
		} else if ('attachEvent' in window) {	//IE 
			window.attachEvent('onmessage', receiveMessage);
		}		
	}

	fAddEventListener();
	
	function addEvent(obj, type, listener) {
		if(window.addEventListener){
			obj.addEventListener(type, listener, false);
		}else{
			obj.attachEvent('on'+type, listener);
		}
	}
  
	